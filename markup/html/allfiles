<!DOCTYPE html>
<html lang="en" style="background-image: none!important;background-color: transparent">
<head>
	<meta charset="UTF-8">
	<title>Dashboard</title>
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="//static.jstree.com/3.3.4/assets/dist/themes/default/style.min.css">
	<link rel="stylesheet" href="//static.jstree.com/3.3.4/assets/docs.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>

	<script>

		var decoder = $('<div />');
		var decodedText = '';

		$.getJSON('/html/tree.json', function foo(result) {

			var content = '';
			if (result && result.children) {
				content = '<ul>' + getPath(result.children, false);
				result.children.forEach(function (file) {
					content += renderFile(file);
				});
				content += '</ul>';
			}

			function renderFile(s) {
				if (s.name) {
					var path = s.path ? s.path.replace(s.base, '/html/') : '#';
					return '<li>File <a target="_blank" href=' + path + '>' + s.name + '</a></li>';
				}
				return '';
			}

			function getPath(items, renderFiles) {
				var html = '';
				items.forEach(function (s) {
					if (s.name) { //файлы
						if (renderFiles)
							html += renderFile(s);
					} else { //папки
						var name = s.path.replace(s.base, '').toUpperCase();
						html += '<li><b>' + name + '</b>';
						if (s.children && s.children.length)
							html += '<ul>' + getPath(s.children, true) + '</ul>';
						html += '</li>';
					}
				});
				return html;
			}

//			var elements = result[1].data.children.slice(0, 10);
//
//			$.each(elements, function (index, value) {
//				decoder.html(value.data.body_html);
//				decodedText += decoder.text();
//			});

			$('#content').append(content);
			$('#content').on('changed.jstree', function (e, data) {
				var i, j, r = [];
				if (data.selected.length > 0) {
					var el = data.instance.get_node(data.selected[0]);
					if (el && el.a_attr && el.a_attr.href && el.a_attr.href != '#')
						window.open(el.a_attr.href);
				}

			}).jstree();
		});
	</script>

</head>
<body>


<include data-file="/html/aside.html"></include>
<include data-file="/html/header.html"></include>

<section class="main">

	<div id="content" style="margin-left: 200px">

	</div>

</section>


</body>
</html>
